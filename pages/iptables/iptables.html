<!DOCTYPE html>
<html>

<head>

<title>J. Kerr</title>
<link rel="stylesheet" href="/css/bootstrap.min.css">
<script src="/js/jquery-3.1.1.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">


    <title>IP Tables</title>
    <meta charset="utf-8" />


</head>

<body>

<nav class="navbar navbar-default navbar-static-top">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" 
				data-target="#navigation-header-div" aria-expanded="false">
				<span class="sr-only"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="#">JK</a>
    	</div>

		<div class="collapse navbar-collapse" id="navigation-header-div">
			<ul class="nav navbar-nav">
				<li><a href="/index.html">Home</a></li>
				<li><a href="/pages/notes.html">Notes</a></li>
				<li><a href="/pages/about.html">About</a></li>
			</ul>
		</div>

	</div>
</nav>


    <h1>IP Tables</h1>
    <blockquote>
        <p>This is a decent firewall configuration for a home PC running Linux. It allows internal traffic (127.0.0.1) while blocking traffic from the local network, allows you to create outbound connections, but doesn't allow incoming traffic to establish traffic that you didn't initiate. In order to apply this firewall, follow the steps in order from beginning to end.</p>
    </blockquote>
    <ul>
        <li><a href="#view-rules">View rules</a></li>
        <li><a href="#create-rules-file">Create rules file</a></li>
        <li><a href="#load-rules-from-file">Load rules from file</a></li>
        <li><a href="#save-rules-to-file">Save rules to file</a></li>
        <li><a href="#automatically-load-rules-on-startup">Automatically load rules on startup</a></li>
    </ul>
    <section id="view-rules">
        <h2>View rules</h2>
        <pre data-language="bash"><span></span>$ sudo iptables --list
$ sudo iptables  -S
$ sudo iptables -L</pre>
    </section>
    <section id="create-rules-file">
        <h2>Create rules file</h2>
        <pre data-language="bash"><span></span>$ sudo vi /etc/iptables.pc.rules</pre>
        <p>/etc/iptables.pc.rules:</p>
        <pre>*filter

# Allow all loopback (lo0) traffic and drop all traffic to 127/8 that doesn't use lo0
-A INPUT -i lo -j ACCEPT
-A INPUT ! -i lo -d 127.0.0.0/8 -j REJECT

# Accept all established inbound connections
-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

# Allow all outbound traffic
-A OUTPUT -j ACCEPT

# Allow icmp (ping, router error messages, similar traffic)
-A INPUT -p icmp -j ACCEPT

# Reject all other inbound - default deny unless allowed
-A INPUT -j REJECT
-A FORWARD -j REJECT

COMMIT</pre>
    </section>
    <section id="load-rules-from-file">
        <h2>Load rules from file</h2>
        <pre data-language="bash"><span></span>$ sudo iptables-restore &lt; /etc/iptables.pc.rules</pre>
    </section>
    <section id="save-rules-to-file">
        <h2>Save rules to file</h2>
        <pre data-language="bash"><span></span>$ sudo iptables-save &gt; ~/iptables.up.rules
$ sudo mv ~/iptables.up.rules /etc/</pre>
    </section>
    <section id="automatically-load-rules-on-startup">
        <h2>Automatically load rules on startup</h2>
        <pre data-language="bash"><span></span>$ sudo vi /etc/network/if-pre-up.d/iptables</pre>
        <p>/etc/network/if-pre-up.d/iptables:</p>
        <pre data-language="sh"><span></span><span class="ch">#!/bin/sh</span>

/sbin/iptables-restore &lt; /etc/iptables.up.rules</pre>
    </section>


&copy; Jeremy Kerr, 2017

</body>

</html>
