<!DOCTYPE html>
<html>

<head>

<title>J. Kerr</title>
<link rel="stylesheet" href="/css/bootstrap.min.css">
<script src="/js/jquery-3.1.1.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">


    <title>Python Command</title>
    <meta charset="utf-8" />


</head>

<body>

<nav class="navbar navbar-default navbar-static-top">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" 
				data-target="#navigation-header-div" aria-expanded="false">
				<span class="sr-only"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="#">JK</a>
    	</div>

		<div class="collapse navbar-collapse" id="navigation-header-div">
			<ul class="nav navbar-nav">
				<li><a href="/index.html">Home</a></li>
				<li><a href="/pages/notes.html">Notes</a></li>
				<li><a href="/pages/about.html">About</a></li>
			</ul>
		</div>

	</div>
</nav>


    <h1>Python Command</h1>
    <blockquote>
        <p>This shows you how to install a python application as a command in a Linux environment, so that you can call it directly from within a terminal. Note that the application is installed under your user account, so it will not be visible to other users. Additionally, it will not enable you to do anything you wouldn't normally be allowed to do, since it will be running with your user's permissions.</p>
    </blockquote>
    <section id="install-dependencies">
        <h2>Install Dependencies</h2>
        <blockquote>
            <p>In order to do this, there are several dependencies you'll need to have installed: python3, python3-pip, and virtualenv.</p>
        </blockquote>
        <pre data-language="bash"><span class="nv">$ </span>sudo apt-get install python3 python3-pip</pre>
        <p>After this, you should be able to install virtualenv</p>
        <pre data-language="bash"><span class="nv">$ </span>pip3 install virtualenv --upgrade</pre>
        <p>You may want to also upgrade pip3.</p>
        <pre data-language="bash"><span class="nv">$ </span>pip3 install --upgrade pip</pre>
    </section>
    <section id="installation-script">
        <h2>Installation Script</h2>
        <p>Let's assume your Python application is in a directory called "example", the Python 3 library requirements are in a file called "requirements.txt", and the main callable script is "main.py". Therefore your directory structure is as follows:</p>
        <pre>.
./example/
./example/main.py
./example/requirements.txt
./example/&lt;supporting files and resources&gt;</pre>
        <p>For the script to be installed on the system, we'll want a virtual environment for it to run in, and we'll want it stored under <strong>$HOME/bin/example</strong>. Furthermore, we'll want a Bash script that will activate the virtual environment and run the application. Therefore, the directory structure will look like the following:</p>
        <pre>$HOME/bin/example.sh
$HOME/bin/example-venv
$HOME/bin/example/
$HOME/bin/example/main.py
$HOME/bin/example/requirements.txt
$HOME/bin/example/&lt;supporting files and resources&gt;</pre>
        <p>Therefore, the installation script has to complete a number of tasks in order to install the example application.</p>
        <ol type="1">
            <li>Shebang! The script shouldn't assume the correct shell will be used without explicitly specifying.</li>
        </ol>
        <pre data-language="bash"><span class="c">#!/bin/bash</span></pre>
        <ol type="1" start="2">
            <li>Save the current directory to a variable, so it can be restored after the installation.</li>
        </ol>
        <pre data-language="bash"><span class="nv">CURRENT_DIR</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span></pre>
        <ol type="1" start="3">
            <li>Ensure that the $HOME/bin directory exists, otherwise create it.</li>
        </ol>
        <pre data-language="bash"><span class="o">[</span> -d <span class="nv">$HOME</span>/bin <span class="o">]</span> <span class="o">||</span> mkdir <span class="nv">$HOME</span>/bin</pre>
        <ol type="1" start="4">
            <li>Copy the example directory contents to $HOME/bin/example.</li>
        </ol>
        <pre data-language="bash">mkdir <span class="nv">$HOME</span>/bin/example
cp -R ./example/* <span class="nv">$HOME</span>/bin/example/</pre>
        <ol type="1" start="5">
            <li>Create a virtual environment and install the requirements.</li>
        </ol>
        <pre data-language="bash"><span class="nb">cd</span> <span class="nv">$HOME</span>/bin/
virtualenv -p python3 example-venv
<span class="nb">source </span>example-venv/bin/activate
pip install -r requirements.txt --upgrade
deactivate</pre>
        <ol type="1" start="6">
            <li>Change back to the original directory.</li>
        </ol>
        <pre data-language="bash"><span class="nb">cd</span> <span class="nv">$CURRENT_DIR</span></pre>
        <ol type="1" start="7">
            <li>Check if <strong>$HOME/bin</strong> is in the bash profile, otherwise append it and reload the profile.</li>
        </ol>
        <pre data-language="bash"><span class="k">if</span> ! grep -Fq <span class="s2">&quot;PATH=\&quot;\$HOME/bin:\$PATH\&quot;&quot;</span> <span class="nv">$HOME</span>/.profile <span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> -e <span class="s2">&quot;\n# set PATH so it includes user&#39;s private bin if it exists\n&quot;</span> &gt;&gt; <span class="nv">$HOME</span>/.profile
    <span class="nb">echo</span> -e <span class="s2">&quot;if [ -d \&quot;\$HOME/bin\&quot; ]; then\n&quot;</span> &gt;&gt; <span class="nv">$HOME</span>/.profile
    <span class="nb">echo</span> -e <span class="s2">&quot;    PATH=\&quot;\$HOME/bin:\$PATH\&quot;\n&quot;</span> &gt;&gt; <span class="nv">$HOME</span>/.profile
    <span class="nb">echo</span> -e <span class="s2">&quot;fi\n&quot;</span> &gt;&gt; <span class="nv">$HOME</span>/.profile
    <span class="nb">source</span> <span class="nv">$HOME</span>/.profile
<span class="k">fi</span></pre>
        <ol type="1" start="8">
            <li>Write the callable script and enable the user to execute it.</li>
        </ol>
        <pre data-language="bash">touch <span class="nv">$HOME</span>/bin/example.sh
<span class="nb">echo</span> -e <span class="s2">&quot;#!/bin/bash\n&quot;</span> &gt;&gt; <span class="nv">$HOME</span>/bin/example.sh
<span class="nb">echo</span> -e <span class="s2">&quot;\n&quot;</span> &gt;&gt; <span class="nv">$HOME</span>/bin/example.sh
<span class="nb">echo</span> -e <span class="s2">&quot;CURRENT_DIR=\$(pwd)\n&quot;</span> &gt;&gt; <span class="nv">$HOME</span>/bin/example.sh
<span class="nb">echo</span> -e <span class="s2">&quot;\n&quot;</span> &gt;&gt; <span class="nv">$HOME</span>/bin/example.sh
<span class="nb">echo</span> -e <span class="s2">&quot;cd \$HOME/bin/example\n&quot;</span> &gt;&gt; <span class="nv">$HOME</span>/bin/example.sh
<span class="nb">echo</span> -e <span class="s2">&quot;\n&quot;</span> &gt;&gt; <span class="nv">$HOME</span>/bin/example.sh
<span class="nb">echo</span> -e <span class="s2">&quot;source ./example-venv/bin/activate\n&quot;</span> &gt;&gt; <span class="nv">$HOME</span>/bin/example.sh
<span class="nb">echo</span> -e <span class="s2">&quot;\n&quot;</span> &gt;&gt; <span class="nv">$HOME</span>/bin/example.sh
<span class="nb">echo</span> -e <span class="s2">&quot;python example/main.py\n&quot;</span> &gt;&gt; <span class="nv">$HOME</span>/bin/example.sh
<span class="nb">echo</span> -e <span class="s2">&quot;\n&quot;</span> &gt;&gt; <span class="nv">$HOME</span>/bin/example.sh
<span class="nb">echo</span> -e <span class="s2">&quot;deactivate\n&quot;</span> &gt;&gt; <span class="nv">$HOME</span>/bin/example.sh
<span class="nb">echo</span> -e <span class="s2">&quot;\n&quot;</span> &gt;&gt; <span class="nv">$HOME</span>/bin/example.sh
<span class="nb">echo</span> -e <span class="s2">&quot;cd \$CURRENT_DIR/\n&quot;</span> &gt;&gt; <span class="nv">$HOME</span>/bin/example.sh
<span class="nb">echo</span> -e <span class="s2">&quot;\n&quot;</span> &gt;&gt; <span class="nv">$HOME</span>/bin/example.sh

chmod u+x <span class="nv">$HOME</span>/bin/example.sh</pre>
    </section>
    <section id="calling-the-script">
        <h2>Calling the script</h2>
        <p>By now you should be able to call the script by simply opening a terminal and running it from anywhere.</p>
        <pre data-language="bash"><span class="nv">$ </span>example.sh</pre>
    </section>


&copy; Jeremy Kerr, 2017

</body>

</html>
